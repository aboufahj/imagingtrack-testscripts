<TestScript xmlns="http://hl7.org/fhir">
   <id value="TestScript_RDSC_Simulator"/>
   <meta>
      <versionId value="1"/>
      <lastUpdated value="2021-07-19T15:03:17.034+02:00"/>
      <source value="#QIJj07p2hJBEUIvc"/>
   </meta>
   <url value="https://build.fhir.org/ig/HL7/fhir-radiation-dose-summary-ig/TestScript-RDSC-Simulator.json"/>
   <name value="TestScript_RDSC_Simulator"/>
   <status value="active"/>
   <date value="2021-07-17"/>
   <publisher value="HL7 Imaging Integration Workgroup"/>
   <contact>
      <name value="HL7 Imaging Integration Workgroup"/>
      <telecom>
         <system value="url"/>
         <value value="http://www.hl7.org/Special/committees/imagemgt/index.cfm"/>
      </telecom>
   </contact>
   <contact>
      <name value="Abderrazek Boufahja"/>
      <telecom>
         <system value="email"/>
         <value value="abderrazek.boufahja@ge.com"/>
      </telecom>
   </contact>
   <description value="TestScript to validate the FHIR Server searching capabilities."/>
   <copyright value="HL7 2021"/>
   <destination>
      <index value="1"/>
      <profile>
         <system value="http://terminology.hl7.org/CodeSystem/testscript-profile-destination-types"/>
         <code value="FHIR-Server"/>
         <display value="FHIR Server"/>
      </profile>
   </destination>
   <variable>
      <name value="rdsResourceId"/>
      <defaultValue value="b2b7c08611db4b4cad077e8467368273"/>
      <description value="Enter the resource ID of the Observation describing a Radiation Dose Summary, registered in your server."/>
   </variable>
   <variable>
      <name value="patientLink"/>
      <path value="Observation/subject/reference"/>
      <sourceId value="rds-read-response"/>
   </variable>
   <variable>
      <name value="deviceLink"/>
      <path value="Observation/device/reference"/>
      <sourceId value="rds-read-response"/>
   </variable>
   <variable>
      <name value="practitionerLink"/>
      <path value="Observation/performer/reference"/>
      <sourceId value="rds-read-response"/>
   </variable>
   <variable>
      <name value="imagingStudyLink"/>
      <path value="Observation/partOf/reference"/>
      <sourceId value="rds-read-response"/>
   </variable>
   <variable>
      <name value="date"/>
      <path value="Observation/effectiveDateTime/@value"/>
      <sourceId value="rds-read-response"/>
   </variable>
   <!-- TODO improve identifier collection by system -->
   <variable>
      <name value="identifier"/>
      <path value="Observation/identifier/value"/>
      <sourceId value="rds-read-response"/>
   </variable>
   <test>
      <name value="Observation_read"/>
      <description value="Read provided Observation - the radiation dose summary"/>
      <!-- Read the RDS resource, initialize the search parameters -->
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="read"/>
            </type>
            <resource value="Observation"/>
            <description value="Read the Radiation Dose Summary observation ${rdsResourceId}"/>
            <accept value="json"/>
            <encodeRequestUrl value="true"/>
            <params value="/${rdsResourceId}"/>
            <responseId value="rds-read-response"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned HTTP status is 200(OK)."/>
            <direction value="response"/>
            <operator value="in"/>
            <responseCode value="200"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned Observation is not empty."/>
            <direction value="response"/>
            <operator value="notEmpty"/>
            <path value="Observation/id"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Observation_search_patient"/>
      <description value="Search radiation dose summary by patient"/>


      <!-- Validation search on PatientId -->
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Observation"/>
            <description value="Search Radiation Dose Summary using the patientId ${patientLink}"/>
            <accept value="json"/>
            <encodeRequestUrl value="true"/>
            <params value="?code=73569-6&amp;patient=${patientLink}"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the total number of response is greater than 1."/>
            <resource value="Bundle"/>
            <expression value="Bundle.total.toInteger() &gt;= 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Observation_search_device"/>
      <description value="Search radiation dose summary by device"/>
      <!-- Validation search on deviceId -->
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Observation"/>
            <description value="Search Radiation Dose Summary using the deviceId ${deviceLink}"/>
            <accept value="json"/>
            <encodeRequestUrl value="true"/>
            <params value="?code=73569-6&amp;device=${deviceLink}"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the total number of response is greater than 1."/>
            <resource value="Bundle"/>
            <expression value="Bundle.total.toInteger() &gt;= 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Observation_search_partof"/>
      <description value="Search radiation dose summary by part-of"/>
      <!-- Validation search on ImagingStudyId -->
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Observation"/>
            <description value="Search Radiation Dose Summary using the ImagingStudy ID ${imagingStudyLink}"/>
            <accept value="json"/>
            <encodeRequestUrl value="true"/>
            <params value="?code=73569-6&amp;part-of=${imagingStudyLink}"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the total number of response is greater than 1."/>
            <resource value="Bundle"/>
            <expression value="Bundle.total.toInteger() &gt;= 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Observation_search_identifier"/>
      <description value="Search radiation dose summary by identifier"/>
      <!-- Validation search on identifier -->
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Observation"/>
            <description value="Search Radiation Dose Summary using the identifier of the Observation ${identifier}"/>
            <accept value="json"/>
            <encodeRequestUrl value="true"/>
            <params value="?code=73569-6&amp;identifier=${identifier}"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the total number of response is greater than 1."/>
            <resource value="Bundle"/>
            <expression value="Bundle.total.toInteger() &gt;= 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Observation_search_date"/>
      <description value="Search radiation dose summary by date"/>
      <!-- Validation search on date -->
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="search"/>
            </type>
            <resource value="Observation"/>
            <description value="Search Radiation Dose Summary using the date of the Observation ${date}"/>
            <accept value="json"/>
            <encodeRequestUrl value="true"/>
            <params value="?code=73569-6&amp;date=${date}"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the total number of response is greater than 1."/>
            <resource value="Bundle"/>
            <expression value="Bundle.total.toInteger() &gt;= 1"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Observation_read_patient"/>
      <description value="Read patient resource"/>
      <!-- Read Patient resource -->
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="read"/>
            </type>
            <description value="Read the Patient ${patientLink}"/>
            <accept value="json"/>
            <encodeRequestUrl value="true"/>
            <responseId value="patient-read-response"/>
            <url value="${patientLink}"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned HTTP status is 200(OK)."/>
            <direction value="response"/>
            <operator value="in"/>
            <responseCode value="200"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned Patient is not empty."/>
            <resource value="Patient"/>
            <direction value="response"/>
            <operator value="notEmpty"/>
            <path value="id"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Observation_read_device"/>
      <description value="Read device resource"/>
      <!-- Read Device resource -->
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="read"/>
            </type>
            <description value="Read the Device ${deviceLink}"/>
            <accept value="json"/>
            <encodeRequestUrl value="true"/>
            <responseId value="device-read-response"/>
            <url value="${deviceLink}"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned HTTP status is 200(OK)."/>
            <direction value="response"/>
            <operator value="in"/>
            <responseCode value="200"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned Device is not empty."/>
            <resource value="Device"/>
            <direction value="response"/>
            <operator value="notEmpty"/>
            <path value="id"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Observation_read_practitioner"/>
      <description value="Read practitioner resource"/>
      <!-- Read Practitioner resource -->
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="read"/>
            </type>
            <description value="Read the Practitioner ${practitionerLink}"/>
            <accept value="json"/>
            <encodeRequestUrl value="true"/>
            <responseId value="practitioner-read-response"/>
            <url value="${practitionerLink}"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned HTTP status is 200(OK)."/>
            <direction value="response"/>
            <operator value="in"/>
            <responseCode value="200"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned Practitioner is not empty."/>
            <resource value="Practitioner"/>
            <direction value="response"/>
            <operator value="notEmpty"/>
            <path value="id"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
   <test>
      <name value="Observation_read_imagingstudy"/>
      <description value="Read imagingstudy resource"/>
      <!-- Read ImagingStudy resource -->
      <action>
         <operation>
            <type>
               <system value="http://terminology.hl7.org/CodeSystem/testscript-operation-codes"/>
               <code value="read"/>
            </type>
            <description value="Read the ImagingStudy ${imagingStudyLink}"/>
            <accept value="json"/>
            <encodeRequestUrl value="true"/>
            <responseId value="imagingstudy-read-response"/>
            <url value="${imagingStudyLink}"/>
         </operation>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned HTTP status is 200(OK)."/>
            <direction value="response"/>
            <operator value="in"/>
            <responseCode value="200"/>
            <warningOnly value="false"/>
         </assert>
      </action>
      <action>
         <assert>
            <description value="Confirm that the returned ImagingStudy is not empty."/>
            <resource value="ImagingStudy"/>
            <direction value="response"/>
            <operator value="notEmpty"/>
            <path value="id"/>
            <warningOnly value="false"/>
         </assert>
      </action>
   </test>
</TestScript>